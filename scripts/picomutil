#!/bin/bash

usage() {
    printf "Usage: picomutil <start|toggle|animation-toggle>\n"
    exit 1
}

kill() {
    killall -q picom
}

start() {
    picom --experimental-backends --config "$HOME/.config/awesome/external/picom/picom.conf" &
}

start_animations() {
    picom --animations --experimental-backends --config "$HOME/.config/awesome/external/picom/picom.conf" &
}

notif() {
    icon="placeholder"
    if [ $3 ]; then
        icon="$3"
    fi

    time="2000"
    if [ $4 ]; then
        icon="$4"
    fi

    # this hint allows the notification to replace previous confirmation notifications
    dunstify -h "string:x-canonical-private-synchronous:anything" -a "picomutil" -i "$icon" -u "normal" -t "$time" "$1" "$2"
}

if [[ ! $1 ]]; then
    usage
fi

case $1 in
    start)
        kill

        if [ "$(cat ~/.cache/picom_animations)" == "true" ]; then
            start_animations
        else
            start
        fi
        ;;

    toggle)
        if pgrep -x picom > /dev/null; then
            kill
            notif "Compositor" "Picom disabled"
        else
            if [ "$(cat ~/.cache/picom_animations)" == "true" ]; then
                start_animations
            else
                start
            fi

            notif "Compositor" "Picom enabled"
        fi
        ;;

    animation-toggle)
        kill

        if [ "$(cat ~/.cache/picom_animations)" == "true" ]; then
            start
            echo "false" > ~/.cache/picom_animations
            notif "Compositor" "Window animations disabled"
        else
            start_animations
            echo "true" > ~/.cache/picom_animations
            notif "Compositor" "Window animations enabled"
        fi
        ;;

    *)
        usage
        ;;
esac
